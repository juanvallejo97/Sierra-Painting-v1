#!/bin/bash
# Pre-commit hook for Sierra Painting
# Runs linting and formatting checks before commit

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if Flutter is available
if ! command -v flutter &> /dev/null; then
    echo "âš ï¸  Flutter not found, skipping Flutter checks"
else
    # Check for Dart formatting
    echo "ğŸ“ Checking Dart formatting..."
    if ! dart format --output=none --set-exit-if-changed lib/ test/ 2>/dev/null; then
        echo "âŒ Dart formatting issues found. Run: dart format ."
        exit 1
    fi
    
    # Run Flutter analyzer
    echo "ğŸ”¬ Running Flutter analyzer..."
    if ! flutter analyze --no-fatal-infos 2>/dev/null; then
        echo "âŒ Flutter analyzer found issues"
        exit 1
    fi
fi

# Check if Node.js is available for Functions
if [ -d "functions" ] && command -v npm &> /dev/null; then
    echo "ğŸ” Checking Cloud Functions..."
    cd functions
    
    # Run TypeScript linter
    if [ -f "package.json" ] && grep -q "lint" package.json; then
        echo "ğŸ“ Running ESLint..."
        if ! npm run lint -- --quiet 2>/dev/null; then
            echo "âŒ ESLint found issues. Run: cd functions && npm run lint"
            cd ..
            exit 1
        fi
    fi
    
    cd ..
fi

echo "âœ… All pre-commit checks passed!"
