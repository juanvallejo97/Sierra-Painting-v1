<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Sierra Painting Business Management">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Sierra Painting">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png"/>
  <title>Sierra Painting</title>
  <link rel="manifest" href="manifest.json">
  <script>
    var serviceWorkerVersion = null;
    var scriptLoaded = false;
    function loadMainDartJs() {
      if (scriptLoaded) {
        return;
      }
      scriptLoaded = true;
      var scriptTag = document.createElement('script');
      scriptTag.src = 'main.dart.js';
      scriptTag.type = 'application/javascript';
      document.body.append(scriptTag);
    }

    if ('serviceWorker' in navigator) {
      // Attempt to unregister any existing service workers first. Some clients
      // can be stuck serving an old cached bundle which leads to a blank/black
      // screen. Unregistering forces the browser to load the latest files.
      try {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for (const reg of registrations) {
            try { reg.unregister(); } catch (e) { /* ignore */ }
          }
        }).catch(function() { /* ignore */ });
      } catch (e) {
        // noop
      }

      // NOTE: we intentionally do not register a new service worker here to
      // avoid immediately caching potentially stale assets. You can re-enable
      // registration later after confirming clients are loading the new bundle.
    }
  </script>
</head>
<body>
  <script src="main.dart.js" type="application/javascript"></script>
  <div id="flutter-init-error" style="display:none;position:fixed;inset:0;z-index:9999;background:#111;color:#fff;align-items:center;justify-content:center;">
    <div style="max-width:720px;margin:0 auto;padding:24px;text-align:center;">
      <h2 style="color:#ff6b6b">App failed to initialize</h2>
      <p>The app failed to start correctly. This can happen when Firebase initialization or App Check fails, or when an older cached bundle is running. Try a hard refresh (Ctrl+F5) or clear site data.</p>
      <p><button onclick="location.reload();" style="padding:8px 16px">Reload</button></p>
      <pre id="flutter-init-error-details" style="text-align:left;background:#222;padding:12px;border-radius:6px;margin-top:12px;white-space:pre-wrap;max-height:240px;overflow:auto;font-size:12px"></pre>
    </div>
  </div>
  <script>
    // Show error overlay if Flutter does not set window.flutterReady within 5s.
    function showFlutterInitError(msg){
      try{
        var el = document.getElementById('flutter-init-error');
        var details = document.getElementById('flutter-init-error-details');
        if(el){ el.style.display = 'flex'; }
        if(details){
          if(typeof msg === 'string') details.textContent = msg;
          else details.textContent = JSON.stringify(msg);
        }
      }catch(e){/* ignore */}
    }

    // Capture global errors and unhandled promise rejections and surface them
    // in the overlay so debugging is easier for clients.
    window.addEventListener('error', function(evt){
      var m = evt.message || (evt.error && evt.error.message) || String(evt);
      var s = evt.filename ? (evt.filename + ':' + evt.lineno + ':' + evt.colno) : '';
      showFlutterInitError('Uncaught error: ' + m + '\n' + s + '\n' + (evt.error && evt.error.stack ? evt.error.stack : ''));
    });
    window.addEventListener('unhandledrejection', function(evt){
      try{
        var reason = evt.reason || 'Unhandled rejection';
        showFlutterInitError('Unhandled promise rejection: ' + (reason.stack || reason));
      }catch(e){}
    });

    // Override console.error to also surface messages in the overlay (non-invasive)
    (function(){
      var orig = console.error;
      console.error = function(){
        try{
          var args = Array.prototype.slice.call(arguments).map(function(a){
            try{ return (typeof a === 'string') ? a : JSON.stringify(a); }catch(e){ return String(a); }
          }).join(' ');
          showFlutterInitError('Console.error: ' + args);
        }catch(e){}
        if(orig) orig.apply(console, arguments);
      };
    })();

    setTimeout(function(){
      try{
        if(!window.flutterReady){
          showFlutterInitError('No readiness signal from Flutter (window.flutterReady not set). Check console for errors.');
        }
      }catch(e){/* ignore */}
    },5000);
  </script>
</body>
</html>
